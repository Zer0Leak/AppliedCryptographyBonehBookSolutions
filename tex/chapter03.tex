\chapter{Stream ciphers}

\noindent
\textbf{3.1}
\textbf{(Semantic security for random messages).} One can define a notion of semantic security for random messages.
Here, one modifies Attack Game 2.1 so that instead of the adversary choosing the messages $m_0$ , $m_1$ , the challenger generates $m_0$ , $m_1$ at random from the message space.
Otherwise, the definition of advantage and security remains unchanged.

\begin{enumerate}[(a)]
\item Suppose $\mathcal{E}=(\mathsf{E},\mathsf{D})$ is defined over $(\mathcal{K},\mathcal{M},\mathcal{C})$, where $\mathcal{M}=\{0,1\}^L$. Assuming that $\mathcal{E}$ is semantically secure for random messages, show how construct a new cipher $\mathcal{E}'$ that is secure in the ordinary sense. You new cipher should be defined over $(\mathcal{K}',\mathcal{M}',\mathcal{C}')$, where $\mathcal{K}'=\mathcal{K}$ and $\mathcal{M}'=\mathcal{M}$.
\item Give an example of a cipher that is semantically secure for random messages but that is not semantically secure in the ordinary sense.
\end{enumerate}

\begin{tcolorbox}[solutionbox, title=Answer: (a)]
    $E(k, m)$ is secure for a random $m$.

    Make $k = k'$
    \vspace{1em}

    Definition of $E'$:

    - Generate $r$ from random $\{0,1\}^L$

    - $(r, E'(k', m')) := E(k, m' \oplus r) := E(k, m) = c'$
    \vspace{1em}

    Notice that $m = m \oplus r$ is random, so $E$ is secure for it.

    Notice that, if the adversary knows $r$ and $c'$, it doesn't help to get $m$, because it is encrypted with $k$.
    \vspace{1em}

    Definition of $D'$:

    - $m':= (r, D'(k', c')) := D(k, c') \oplus r := D(k, E(k, m)) \oplus r := m \oplus r$
\end{tcolorbox}

\begin{tcolorbox}[solutionbox, title=Answer: (b)]
    Consider $E$ such that $c \in \{0,  1\}^{L + 1}$.
    The function $E$ extends the bitstring $c$ by appending a single $0$ bit at the end of $c$ in the message is exactly $0^L$. Otherwise it appends $1$.

    The chance of the adversary in this game is:

    $1.0 \times 2^{L-1} + \frac{1}{2^L - 1} \times \frac{2^L - 1}{2^L} + negl(L) = 2^{-(L-1)} + negl(L)$
    

    Notice that $2^{-L}$ is negligible so $2 \times 2^{L-1}$ is too, and therefore is $2^{-(L-1)} + negl(L)$.
    \vspace{1em}

    Now the only thing the (ordinary sense) adversary needs to do is choose $m_0 := 0^L$ and $m_1 \neq m_0$.
    And now the chance becomes $1.0$ because if $c$ end with $0$, $m_0$ was chosen, otherwise was $m_1$.
\end{tcolorbox}



\newpage
\noindent
\textbf{3.2}
\textbf{(Encryption chain.} Let $\mathcal{E} = (E, D)$ be a cipher defined over $(\mathcal{K},\mathcal{M},\mathcal{C})$ where $\mathcal{K} = \mathcal{M}$.
Let $\mathcal{E'} = (E', D')$ be a cipher where encryption is defined as $ $. Show that if $\mathcal{E}$ is semantically secure then so is $\mathcal{E}'$.

\begin{tcolorbox}[solutionbox, title=Answer]

\end{tcolorbox}


\newpage
\noindent
\textbf{3.6}
\textbf{(Another malleability example).}

Let us give another example illustrating the malleability of stream ciphers.
Suppose you are told that the stream cipher encryption of the message
``attack at dawn'' is
\texttt{6c73d5240a948c86981bc294814d}
(the plaintext letters are encoded as 8-bit ASCII and
the given ciphertext is written in hex).
What would be the stream cipher encryption of the message
``attack at dusk'' under the same key?
\begin{tcolorbox}[solutionbox, title=Answer]

In a stream cipher the key string of the same length is the same for the same seed.

So, if $m_0$ and $m_1$ has the same length:

$c_0 = s\oplus m_0$ and $c_1 = s \oplus m_1$, thus

$c_0 \oplus m_0 = s = c_1 \oplus m_1$

$c_1 = c_0 \oplus m_0 \oplus m_1$

$m_0$ and $m_1$ are equal except for the last 3 letters, so we only need to compute these XORs.

$c_1[10] = c_0[10] \oplus m_0[10] \oplus m_1[10] = 94 \oplus `a` \oplus `u` = 94 \oplus 61 \oplus 75$

Do the same for the last 2 letters.

$c_1 =$ \texttt{6c73d5240a948c86981bc2808548}

\end{tcolorbox}


\newpage
\noindent
\textbf{3.20}
\textbf{(Nested PRG construction).} Let $G_0 : \mathcal{S} \to \mathcal{R}_1$ and $G_1 : \mathcal{R}_1 \to \mathcal{R}_2$ be two secure PRGs.
Show that $G(s) := G_1 (G_0 (s))$ mapping $\mathcal{S}$ to $\mathcal{R}_2$ is a secure PRG.

\begin{tcolorbox}[solutionbox, title=Answer]

    Let's prove by contraposition.

    To simplify, let's define:

    $H_0 = G_1(G_0(s))$, where $s\stackrel{r}{\leftarrow}\mathcal{S}$

    $H_1 = G_1(r_1)$, where $r_1\stackrel{r}{\leftarrow}\mathcal{R}_1$

    $H_2 = r_2$, where $r_2\stackrel{r}{\leftarrow}\mathcal{R}_2$

    If $\mathcal{B}$ breaks $G_1(G_0(r))$, then:
    \vspace{1em}
    
    $|\Pr[\mathcal{B}(H_0) = 1] - \Pr[\mathcal{B}(H_2) = 1]| = \epsilon$, where $\epsilon$ is non-negligible.

    $|\Pr[\mathcal{B}(H_0) = 1] - \Pr[\mathcal{B}(H_1) = 1]| + |\Pr[\mathcal{B}(H_1) = 1] - \Pr[\mathcal{B}(H_2) = 1]| \ge \epsilon$

    So, at least one of the two terms of the sum is $\ge \epsilon/2$.
    \vspace{1em}

    If $|\Pr[\mathcal{B}(H_0) = 1] - \Pr[\mathcal{B}(H_1) = 1]| \ge \epsilon/2$, then adversay $\mathcal{B}$ can break $G_0$.

    It is easy to see. The challenger sends $G_0(s)$ or $r_1$ to $\mathcal{B}$. $\mathcal{B}$ computes $G_1$ of this input and just distinguishes between the two cases.
    \vspace{1em}

    If $|\Pr[\mathcal{B}(H_1) = 1] - \Pr[\mathcal{B}(H_2) = 1]| \ge \epsilon/2$, then $G_1$, by definition is not secure.

    So, if $G_1(G_0(s))$ is not secure, then at least one of $G_0$ or $G_1$ is not secure.

\end{tcolorbox}


\newpage
\noindent
\textbf{3.22}
\textbf{(Bad seeds).} Show that a secure PRG $G : \{0, 1\}^n \to R$ can become insecure if the seed is not uniformly random in $S$.

\begin{enumerate}[(a)]
\item Consider the PRG $G' : \{0, 1\}^{n+1} \to R \times \{0, 1\}$ defined as $G'(s_0 \| s_1) = (G(s_0), s_1)$. Show that $G'$ is a secure PRG assuming $G$ is secure.
\item Show that $G'$ becomes insecure if its random seed $s_0 \| s_1$ is chosen so that its last bit is always $0$.
\item Construct a secure PRG $G'' : \{0, 1\}^{n+1} \to R \times \{0, 1\}$ that becomes insecure if its seed $s$ is chosen so that the parity of the bits in $s$ is always $0$.
\end{enumerate}

\begin{tcolorbox}[solutionbox, title=Answer: (a)]

    We are assuming $s_0$ and $s_1$ are uniformly random and independent

    Let's prove by contraposition. \textit{I.e.} if $G'$ is not secure, then $G$ is not secure.

    There is an adversary $\mathcal{A}$ that breaks $G'$. let's wrap it to build an adversary $\mathcal{B}$ that breaks $G$.

    The challenger send either $G(s_0)$ or $s_0$ to $\mathcal{B}$. $\mathcal{B}$ appends a random bit $s_1$ to the input and send it to $\mathcal{A}$.

    $\mathcal{B}$ just outputs whatever $\mathcal{A}$ outputs, and has the same non-negligible advantage to distinguish the two cases.

\end{tcolorbox}

\begin{tcolorbox}[solutionbox, title=Answer: (b)]

    Just build an adversary $\mathcal{A}$ that checks the last bit of the input. If the last bit is $0$, it outputs $0$, otherwise $1$.

    The experiment with $G'$ has probability 0 to output $1$, while the experiment with a random string has probability $1/2$ to output $1$.

    $\Pr[\mathcal{A}(G'(s_0 \| s_1)) = 1] - \Pr[\mathcal{A}(r) = 1]$ = 1/2, which is not negligible.

\end{tcolorbox}


\begin{tcolorbox}[solutionbox, title=Answer: (c)]

    $G''(s) = (G(s), \text{parity}(s))$

    So, it is broken essentially with the same adversary of question (b).

\end{tcolorbox}
